主键和外键：

关系型数据库不能设置两个主键,但可以将两个字段的组合作为一个主键即联合主键.主键是唯一区分,与唯一约束是有区别的,主键一张表只有一个,可以做外键,不能为空，唯一约束可以有多个，主要用来约束字段的唯一性.
外健是关联的数据,联表查询有无外键都可以, update的作为外键的主键的value时或删除主键的记录时,会做关联检查,具体的约束规则可以设置,比如是不允许更新或删除,或者是全部更新或删除,用于保证数据的完整性和一致性,
外键的意义：用于与其他表建立连接，用于预防破坏表之间的链接；防止非法数据插入到外键列，因为要插入的值必须已经是在其他表中的主键出现了才行。
数据库支持事物,支持外键,那么一致性在数据库服务器完成, 如果数据库不支持但又要处理事务就要在在业务代码中完成.
在并发不大压力不大时,可以使用外键,减小开发工作量,很多业务逻辑上的校验不用写代码完成.
但如果互联网行业并发大的时候一般不使用,因为数据库服务器做关联性检查会拖慢数据库的速度.而应用服务器是可以方便扩展的.

mongodb不能支持事务，不能自动回滚，需要自己实现回滚逻辑，也不支持多表查询

创建表的时候很容易字段里面出现空格，建好之后用desc table一下，查看是否有多的空格，不然插入数据会失败。SQL操作时，若字段是关键字，需要单引号转义。

索引：b树和b+树都是多路平衡搜索树，b树是中间的节点也会存储数据，b+树只有最后的叶子节点存储数据，用b+树索引是相对于b树每个节点存储的索引信息会更多，
因为不用存储数据。为了方便批量查询，b+树的叶子节点会通过指针连接起来。

nosql放弃了关系数据库的两大重要基础: 以关系代数为基础的结构化查询语言和事物一致性保证(ACID),nosql相比于关系型数据库,方便扩展列, 
关系型数据库为了保证关系运算(通过sql)的正确性, 在设计数据库表结构的时候,就需要指定表的schema即字段名称及属性,并需要遵循特定的设计范式. 

消息队列可以提升系统性能, 变成了异步模式, 也降低了系统耦合性.
分布式消息队列可以很复杂, 比如可以支持ESB(企业服务总线), 也可以很简单,比如用mysql也可以当做分布式消息队列:
消息生产者程序将消息当做数据记录写入数据库,消息消费者程序查询数据库并按记录写入时间戳排序,就实现了一个事实上的分布式消息队列.
数据库也可以用作消息队列,但是性能有限, 生产中往往在数据库前加缓存或消息队列, 应对短时间内的大并发.
消息队列采用发布-订阅者模式,需要考虑是否会丢数据, 队列内存满了会写到磁盘, 并且消息只有被消费了才从队列中删除. 消息历史记录看不到, 用数据库做消息队列更容易追溯.
整个架构可以横向拆分和竖向拆分, 业务也能进行横向拆分和竖向拆分, 横向拆分是将复用的业务拆出来, 竖向拆分是将大的服务拆分成多个小的服务.

消息队列应用场景
https://blog.csdn.net/dj2008/article/details/78872889

mongodb副本集：
（1）三个节点，若两个节点挂掉，第三个节点只能读不能写，若配置的时候就只有一个节点，配置为副本集，读写都是可以的。或一开始3个节点，然后主动remove两个，剩下的一个也是读写都可以。
（2）主节点上的用户和密码也会同步到其他节点上去，不用在从节点上创建用户密码，若创建也是可以的。
（3）从单机升级为副本集，修改配置文件重启下就ok，再从副本集切回单机，将配置文件修改再重启即可，若再切回副本集出现一直是other状态，则reconfig一下。

mongodb聚合查询：

    $match是匹配条件， _id之后的是用于区分的， $addToSet/$min/$max/$sum是聚合函数。group之前的match，是对源数据进行查询，group之后的match是对group之后的数据进行筛选。 
    db.AttackAction.aggregate([ {$match:{'src_ip': '183.39.156.231'}},
                                    {$group:
                                        {_id: {'src_ip': '$src_ip', 'type_name': '$type_name'}, 
                                        'ip': {$addToSet: '$ip'},
                                        'net_action': {$addToSet: '$net_action'},
                                        'risk_level': {$min: '$risk_level'},
                                        'start_time': {$min: '$record_time'},
                                        'end_time': {$max: '$record_time'},
                                         cnt: {$sum: 1},
                                         }
                                    } ,
                                    { $sort:{'cnt':-1}}
                                    ])
 
    可以在group的基础上再group一次，可以叠加的，$addToSet去重，$push不去重; $project是对最终的结果重新进行选择或者对字段进行重命名
    db.AttackAction.aggregate([{$match:{'record_time': {$gte: 0, $lt: 1497088856}}},
                                    {$group: {_id: {'src_ip': '$src_ip', 'type_name': '$type_name'}, 
                                        'ip': {$addToSet: '$ip'},
                                        'net_action': {$addToSet: '$net_action'},
                                        'risk_level': {$min: '$risk_level'},
                                        'start_time': {$min: '$record_time'},
                                        'end_time': {$max: '$record_time'},
                                        cnt: {$sum: 1}
                                    }},
                                    {$group: {_id: {'src_ip': '$_id.src_ip'},
                                        'detail': {
                                            $push : {
                                                'ip': '$ip', 
                                   'start_time': {$min: '$start_time'},
                                        'end_time': {$max: '$end_time'},
                                        total: {$sum: '$cnt'}
                                    }},
                                    {$sort: {'type_list.risk_level': 1, 'total': -1}}
                        $project:{
                                'net_action': '$net_action',
                                                'risk_level': '$risk_level', 
                             'type_list': {
    
                                                     $push: {
    
                                                    'type_name': '$_id.type_name',
    
                                                    'type_cnt': '$cnt'
    
                                                  }
                                            }]
                                        },
 




 
