## 秒杀系统
秒杀功能跟正常的购买流程一样，只是库存少，时间有限制，会导致短时间内有大量并发请求，最终有效的请求比较少。
商品购买的流程是：查询库存，修改库存，生成订单，支付，要保证操作的事务性。

如果只用MySQL也能实现功能，需要订单表和库存表。 如果操作数据库不当并发情况下会导致超卖。
这个时候就要使用锁来保持一致性，可以用悲观锁也可以用乐观锁，两者导致的并发性能不一样。

在功能完成的基础上，为了继续提供性能可以水平增加web服务器，库存放redis里面，使用限流控制无效请求。

<秒杀架构实践> https://crossoverjie.top/%2F2018%2F05%2F07%2Fssm%2FSSM18-seconds-kill%2F

## 悲观锁和乐观锁
这两者是操作数据库层面的，与实现的语言无关，可以是原生的sql语句，也可以是Python，Java等。
悲观锁：在查询商品库存的时候select for update显式加锁，在发生事务的commit或者是事务的rollback时，自动释放该锁，这样其他用户就可以接着查询该商品。

乐观锁：乐观锁没有用到MySQL本身的行锁表锁，实现方式有两种，(1)用update语句更新库存时增加判断条件库stock=prevstock,如果没有其他线程改动就会更新成功，如果其他线程
已经做了改动，就会更新失败，后面的生成订单也就不会执行，然后又重新从库存查询开始执行，知道下单成功或者库存为0；(2)库存表增加一个version字段，
每次对库存的更改都对version+1，用update语句更新库存的时候使用判断条件version=prevversion,跟方式1一样，就是多了个字段。

并发量高的时候使用乐观锁，因为悲观锁加锁消耗资源； 并发量低的时候使用悲观锁，因为乐观锁循环耗费时间。


<乐观锁与悲观锁的实际应用> https://crossoverjie.top/%2F2017%2F07%2F09%2FSSM15%2F
<python数据库并发处理（乐观锁）> https://blog.csdn.net/hello_mumu/article/details/82253456